---
title: Cosma Docs
author:
  - Guillaume Brioudes <https://myllaume.fr/>
  - Arthur Perret <https://www.arthurperret.fr/>
date: 2021-06-02
lang: en-GB
---

Cosma is a document graph visualisation software. It allows you to represent interrelated notes as an interactive network in a web interface. Cosma is designed to work with Markdown text files and is suitable for both small collections (about a hundred documents) and sprawling knowledge bases (up to several thousand documents).

Cosma was created through the [HyperOtlet](https://hyperotlet.hypotheses.org/) research programme, funded by the National Agency of Research (ANR, France).

::: sommaire
#. [Introduction](#introduction)
#. [Installing](#installing)
#. [Settings](#settings)
#. [Using the cosmographer](#using-the-cosmographer)
#. [Using the cosmoscope](#using-the-cosmoscope)
#. [Development](#development)
#. [Credits](#credits)
:::

# Introduction

Cosma is a document graph visualisation software. It allows you to represent interrelated notes as an interactive network in a web interface. Cosma is not a note-taking application: it was designed to work in conjunction with note-taking software, only requiring that notes be structured according to a specific format.

Most visualisation tools present themselves through a graphical user interface (GUI), from which it is possible to export structured data or static images. Cosma reverses this logic: the application part, which we call the **cosmographer**, is just a form; the export, an HTML file we call the **cosmoscope**, is the actual visualisation interface. This stand-alone file contains an interactive graph, internal navigation tools (index, search engine, filters) and the full text of the records; it also includes the source data as JSON and can be used offline.

Cosma is designed to give a high degree of control to its users.

Firstly, Cosma works with any directory of text-based files and only reads the data: using or uninstalling the software will not alter your files and therefore does not interfere with your storage, versioning and editing practices.

Second, almost all of Cosma's interface elements are customisable: the network drawing algorithm, the colours, the stroke of links… You can even add permanent shortcuts to specific visual configurations (“views”) you may come across during navigation and want to access again later.

Thirdly, documentary and semantic enrichments are possible through the addition of metadata on both nodes (documents) and links (relationships between documents). This is done through generic mechanisms, allowing you to use the typologies and ontologies of your choice.

And fourthly, Cosma is modular, interoperable and portable, but above all free software. The code is public, documented, and it is accessible and reusable free of charge under the MIT license. Our work can thus be evaluated, archived and continued by others.

# Installing

## Pre-requisites

Install [Node.js](https://nodejs.org/fr/download/) version 12 or higher.

Using the cosmoscope requires a web browser. You can use the following browsers, in the version mentioned or higher:

- Chrome (v.69)
- Edge (v.79)
- Firefox (v.62)
- Opera (v.56)
- Safari (v.12)

The cosmoscope is not compatible with Internet Explorer.

## Downloading Cosma

Download the Cosma git repository by typing the command below in a terminal, or by clicking on the following link: <https://github.com/hyperotlet/cosma/archive/master.zip>

```bash
git clone https://github.com/hyperotlet/cosma.git
```

## Installing the dependencies

Cosma relies on other programs called dependencies. Cosma uses the NPM dependency manager which is installed at the same time as Node.js. Install the dependencies necessary for the application to function properly with the command below:

```bash
npm install --only=production
```


# Settings

Cosma uses a [YAML](http://yaml.org) configuration file. It is a hierarchical list of parameters whose values modify the behaviour of the software.

::: astuce
For an introduction to YAML, [click here](https://sweetohm.net/article/introduction-yaml.en.html). For Cosma, it is particularly important to know that in YAML the hierarchy of parameters is implemented by indentation, i.e. the presence of spaces at the beginning of a line, and that the use of tabs to indent lines is forbidden in YAML. It is recommended to choose an indentation unit corresponding to a multiple of 2 spaces (2 or 4) and to stick to it for the whole file.
:::

Run the following command to create the configuration file (`config.yml`) if it does not already exist. You can also delete the file and use this command to reset it. The file generated by this command is a template with all the parameters that must be filled in for the configuration to be considered valid.

```bash
node app
```

## Obligatory parameters

The configuration must contain the following parameters:

`files_origin`
: Path to the directory containing the Markdown files to be read. The syntax depends on the operating system.
: Example: `/Users/user/Fiches/'`, `D:\repertoire\`

`export_target`
: Path to the directory where to export the cosmoscope.
: Example: `./'`, `D:\repertoire\`

::: important
The `files_origin` and `export_target` paths must end in a slash.
:::

`record_types`
: List of record types. Each type is defined by a `name: value` pair where `name` is the name of the type and `value` is a colour of your choice. The colours are declared [as in HTML](https://www.w3schools.com/html/html_colors.asp) with their predefined name or an RGB, HEX, HSL, RGBA or HSLA value in quotes.

Example:

```yaml
record_types:
  undefined: '#546de5'
  very important: red
  reading note: 'rgba(157, 62, 12, 0.7)'
  concept: 'hsl(14, 100%, 80%)'
```

`link_types`
: List of relationship types. Each type is defined by a `name` parameter whose value is a list of two parameters, which affect the representation of the links in the graph: `stroke` corresponds to the shape of the line and `color` to its colour. The value of `stroke` can be `single` (single solid line), `double` (double solid line), `dash` or `dotted`. Colours are declared as in HTML, in the same way as for the record types.

Example:

```yaml
link_types:
  undefined:
    stroke: simple
    color: grey
  special:
    stroke: dash
    color: 'rgba(157, 62, 12, 0.7)'
```

::: important
The default type `undefined` must be set for both record types and link types.
:::

The links settings affects their readability in the graph. In the following example, the user has defined three types of qualified links in the manner of a thesaurus (specific `s`, generic `g` and associated `a`). The parameters are set to enhance the visibility of the qualified links: the default (`undefined`) links are discrete dotted grey lines, while qualified links are more legible, with solid lines and a brighter colour.

```yaml
link_types:
  undefined:
    stroke: dotted
    color: grey
  s:
    stroke: simple
    color: 'rgba(157, 62, 12, 0.7)'
  g:
    stroke: simple
    color: 'rgba(157, 62, 12, 0.7)'
  a:
    stroke: dash
    color: 'rgba(157, 62, 12, 0.7)'
```

## Graph settings

The following parameters define the default value of the graph parameters. Most of these parameters can be changed live in the cosmoscope interface, where you can test different values before setting them in the `config.yml` file: the values set there are restored each time the cosmoscope is reloaded.

```yaml
graph_config:
  background_color: white
  highlight_color: red
  highlight_on_hover: true
  text_size: 9
  position:
    x: 0.5
    y: 0.5
  attraction:
    force: -50
    distance_max: 800
    verticale: 0
    verticale: 0
  arrows: false
```

`background_color`
: Background color of the graph.
: Example: `whitesmoke` ,`#ccc`, `rgb(57, 57, 57)`

`highlight_color`
: Highlight color for selected items.
: Example: `red` ,`#0642ff `, `rgb(207, 52, 118)`

`text_size`
: Size of node labels. The implicit unit is pixels. The minimum value is `5`; the maximum value is `15`.

`position`
: Horizontal (`x`) and vertical (`y`) position of the graph centre. The value must be between 0 (far left) and 1 (far right).

`attraction`
: Parameters of the simulation of forces between nodes.
: Force : `force`: overall power. The lower it is, the looser the links between nodes are. Values above `-50` tend to cause incessant collisions.
: `distance_max`: maximum distance between nodes. Above `1000`, this parameter has no measurable effect.
: Vertical: The force of attraction towards the vertical axis. A value of `0` means that this parameter is disabled.
: Horizontal' : force of attraction towards the horizontal axis. A value of `0` means that this parameter is disabled.

`arrows`
: Display arrows on links, depending on whether you want a directed or undirected graph. Boolean value: `true` or `false`.

## Optional parameters

You can add the following parameters to the configuration file:

`minify`
: Reduces the size of the `cosmoscope.html` file, at the expense of the readability of the source code. Value: `true` or `false`. Disabled by default.

`custom_css`
: Applies any styles declared by the user in the `/template/custom.css` file. Value: `true` or `false`. Disabled by default.

`history`
: Exports a copy of the cosmoscope and its data to a time-stamped sub-folder of the `history` folder. Value: `true` or `false`. Enabled by default.

`metas`
: List of metadata to be used as `meta` tags in the header of the` cosmoscope.html` file. You may use any metadata. When using the `--publish` / `-p` flag on the `modelize` command, some metadata will also be displayed in the interface if they exist: the title replaces the logo at the top of the menu pane; title, author, date and description are displayed in the About pane.

Example:

```yaml
metas:
  author: Firstname Lastname
  keywords:
    - Zettelkasten
    - document graph
  description: "This is my personal knowledge base."
  url: https://domaine.fr/cosmoscope.html
```

`focus_max`
: Maximum focus distance. The value must be an integer greater than or equal to `0`.

`views`
: List of views appearing in the cosmoscope Views section. Each view is defined by a `name: value` pair, where `name` is the name of the view and `value` is a string generated via the Save current view button.

Example:

```yaml
views:
  A nice view: eyJmaWx0ZXJzIjpbImNvbmNlcHQiXX0%3D
  Another view (with focus): eyJyZWNvcmRJZCI6MjAyMTAyMjExNDQ0NTF9
```

## Change the configuration from the command line

The following commands allow you to quickly change the configuration.

Modify the path to the source files:

```bash
node app import <chemin>
```

Modify the cosmoscope export path:

```bash
node app export <chemin>
```

Add a record type:

```bash
node app atype <nom> <couleur>
```

Create a `custom.css` file in the `/template` directory:

```bash
node app css
```

Add a view:

```bash
node app aview <nom> <code>
```

# Using the cosmographer

## Data format

Cosma does not prescribe writing software, but requires a specific data format which combines several writing standards aiming to increase interoperability and data durability:

- YAML for software configuration and file metadata;
- Markdown for file content;
- wiki-like syntax (double brackets `[[ ]]`) to create internal links;
- unique identifiers that serve as targets for internal links.

This combination of writing standards lies at the intersection of several textual cultures: documentation; wikis; note-taking with the Zettelkasten method; academic writing with Pandoc. Therefore, Cosma works particularly well when used in tandem with writing environments that share this approach, such as [Zettlr](https://zettlr.com) or the [Foam](https://foambubble.github.io/foam/) extension for Visual Studio Code and VSCodium.

To be correctly interpreted by Cosma, Markdown files must therefore respect a certain structure, and in particular the presence of a YAML header at the beginning of the file.

Example:

```
---
title: A clever title
id: 20201209111625
type: undefined
tags:
- some relevant keywords
- some more keywords
---
```

The YAML header is delimited by two sets of three single dashes on a line (`---`). Cosma recognises and uses the following four fields:

`title`
: Mandatory.

`id`
: A unique identifier. Mandatory. By default, Cosma uses a timestamp (year, month, day, hours, minutes and seconds) to generate a 14-digit identifier, as some popular Zettelkasten note-taking software do – including [The Archive](https://zettelkasten.de/the-archive/) and [Zettlr](https://www.zettlr.com).

`type`
: A record type. Optional. Only one type can be assigned to one record. If the `type` field is not included or its value does not match one of the types stored in the configuration under the `record_types` parameter, Cosma will interpret the type of the record as `undefined`.

`tags`
: Any keyword(s) attached to the record. Optional. The value must be a list. A record can have as many keywords as you wish.

According to the YAML specification, the list of keywords can be entered in *block* mode:

```yaml
tags:
- some relevant keywords
- some more keywords
```

Or in *flow* mode:

```yaml
tags: [some relevant keywords, some more keywords]
```

You can add additional fields arbitrarily, for example a `description` field.

After the header, you can freely enter your content.

::: important
The rendering of Markdown files as HTML in the cosmoscope is limited to textual elements. Images, for example, are not included and will be replaced by their alternative text when it has been set.
:::

## Creating records with the cosmographer

You can create a Cosma-compliant Markdown file by hand or by using the cosmographer through the command line. There are two options. The first one requires several inputs in succession:

```bash
node app record
```

The second option is a one-liner, allowing you to create a record in one command:

```bash
node app autorecord <titre> <type> <mots-clés>
```

- The `<title>` is the title of the record, which is also the name of the generated file;
- `<type>` is one of the types defined in the configuration;
- `<keywords>` is a comma-separated list of keywords (**without spaces**).

Only the title is mandatory.

## Creating links between records

Within a record, you can create a link to another record with the identifier of the target record in double brackets. The cosmographer recognises these links and uses them to model the structure of the graph.

Example:

```
A link to [[20201209111625]] another record.
```

You can also qualify the link according to the typology you have specified under `link_types` in the configuration. The link type is then added as a prefix to the identifier, with a colon as a separator.

Example:

```
Concept B derives from [[generic:20201209111625]] concept A.
```

## Exporting

To create the `cosmoscope.html` file, use one of these commands:

```bash
node app modelize
node app
```

The `cosmoscope.html` file is exported to the directory defined by `export_target` in the configuration. If the file already exists in the same location, it is overwritten.

If the `history` parameter is set to `true`, a time-stamped subdirectory is also created in the `/history` directory with the following contents:

- a copy of the `cosmoscope.html` file ;
- an `error.log` file listing any errors which may have occurred during the export process;
- a `data` directory containing the `links.json` and `nodes.json` files, respectively the list of links and nodes, with their respective metadata.

This export facilitates data sharing and reuse in other visualisation software.

# Using the cosmoscope

The `cosmoscope.html` file can be opened with a web browser. It can also be shared online, e.g. by uploading on a server via FTP. You can link to a specific record within an online cosmoscope by adding its ID preceded by a `#` at the end of the URL. Example:

`https://site.tld/cosmoscope.html#20210427185546`

## Interface overview

The interface is organised in three columns:

Left side panel (Menu)
: Displays the main navigational features, including search, keywords, index and views, as well as controls for the force-based layout algorithm and other graphical parameters.

Central area (Graph)
: Displays the graph and associated controls (zoom, focus).

Right side panel (Record)
: Displays the records' metadata and contents, as well as a list of outgoing and incoming links (the latter called backlinks).

<!-- ![Cosma interface](https://hyperotlet.huma-num.fr/cosma/img/cosma-interface-schema.png) -->

Change the graph parameters (`graph_config`) to adapt the display to your screen's size and resolution.

<!-- Table: graph parameters in relation to screen size and resolution -->

While the cosmoscope may be displayed on all screens, it is not optimized form small ones (e.g. phones and small tablets).

## Customizing the interface

The interface is built from a Nunjucks (`.njk`) template file and CSS stylesheets stored in the `/template` subdirectory.

The interface can be customised by adding a `custom.css` file in the `/template` folder. You can create the file manually or run the following command:

```bash
node app css
```

The `custom_css` parameter in the configuration allows you to enable or disable the use of this file without having to delete it.

The CSS declarations in `custom.css` replace those in `/template/styles.css` and `/template/print.css` (for print styles) and apply to the `/template/template.njk` file. Check these files directly or with your web browser's inspector to find out which selectors to use for which declarations. For example, the cosmoscope stylesheets use CSS variables to define the colours and fonts used. You can redefine only these variables to quickly change all the interface elements to which they apply.

## Searching

The text field at the top of the left side panel is a search engine. It suggests a list of records whose title is close to your input, using fuzzy search. Clicking on a suggestion selects the corresponding node in the graph and opens the corresponding record in the right side panel.

::: important
The available suggestions are constrained by the record type filters and the focus mode: a record hidden by any of these features will not be accessible via the search engine.
:::

## Filtering by record type

The list of record types at the top of the left-hand side panel allows you to filter the display. Clicking on a type will hide all corresponding records from the graph, index and search engine suggestions. Clicking on a type while holding down the `Alt` key hides all records of the other types.

For a record type to appear, it must be declared under `record_types` in the configuration and be assigned to at least one record.

## Tags

The list of tags in the left-hand side panel allows you to highlight the records that use each tag. Selecting a tag highlights the label of the corresponding nodes in the graph and restricts the index to the corresponding records. You can activate several keywords simultaneously. To deactivate a keyword, click the corresponding button again.

For a tag to appear, it must have been added in at least one record via the `tags` field.

## Index

The alphabetical index of records in the left side panel allows you to access records without going through the graph. Clicking on a title selects the corresponding node in the graph and opens the corresponding record. The index can be sorted in ascending or descending alphabetical order. Filters, keywords and focus mode modify the display of the index.

## Views

At any time, the current state of the graph (selected record, active filters, focus mode) can be saved for quick access. Think of browser bookmarks, but for visual configurations. Clicking on the Save View button copies a code to your clipboard. This code must then be added with a name under the `views` parameter in the configuration:

```
views:
  An interesting view: eyJwb3MiOnsieCI6MCwieSI6MCwiem9vbSI6MX19
```

This adds an button with that name to the Views section in the left side panel. Clicking the button applies all settings that were active when the view was saved. Clicking the button again restores the normal view.

## Graph parameters

This section of the left side panel allows you to change the way the graph is drawn:

- show or hide links ;
- show or hide labels ;
- enable or disable highlight on hover;
- modify the forces simulated by the layout algorithm;
- modify the position of the graph in space;
- modify the size of labels.

These changes will be overwritten each time the page is reloaded. To make them permanent, change the default values set under `graph_config` in the `config.yml` file.

## Graph

The central area of the interface displays the graph. Each node corresponds to a record; the label corresponds to the title of the record. The links correspond to the links established between the records via their identifiers in double brackets.

The nodes' positions are set by a force-based layout algorithm. A coloured bar under the Cosma logo indicates the status of the simulation. Click on it (shortcut: `Space` key) to restart the simulation.

::: tip
Press the `Space` key repeatedly to progressively “unfold” a tangled graph.
:::

The simulation parameters are accessible via the left side panel; their default value can be modified in the `config.yml` file.

The nodes can be moved around slightly by clicking and dragging, but stay subjected to the simulation, so they will snap back to their position.

Hovering over a node temporarily highlights it and its connections. Clicking on a node highlights it and its connections and opens the corresponding record.

You can zoom into the graph with a mouse or touchpad, by double-clicking on the graph background or with the dedicated buttons at the bottom left. The Refocus button (shortcut: `R` key) resets the zoom.

## Focus mode

The Focus button (shortcut: `F` key) at the bottom left of the graph allows you to restrict the display to the selected record and its direct connections. Focus mode only works if you have selected a record.

<!-- ![Cosma focus mode](https://hyperotlet.huma-num.fr/cosma/img/cosma-focus-demo.png) -->

The slider under the Focus button allows you to increase and decrease the focus' range, i.e. the distance up to which connections are displayed. The maximum range is defined by the value of the `focus_max` parameter in the configuration.

::: tip
The focus range slider can be controlled with the arrow keys. You can chain shortcuts: `F` to activate the focus, then the arrows to vary the focus range.
:::

## Records

Records can be opened by clicking on a node, an index entry, a search engine suggestion, or a link in the body of another record. Opening a record displays its contents in the right-hand side panel. This also updates the URL of the page with the record ID: this allows you to navigate between the records you have visited via the browser's Previous / Next functions, but also you browser's history, and to link directly to a record.

Clicking on the “Close” button closes the pane and deselects the corresponding node in the graph.

The links in the body of the records are clickable. You can open these links in a new tab by right-clicking them. The title of the link (displayed in a tooltip after 1-2 seconds of hovering) is that of the corresponding record.

At the bottom of the record is a list of the records to which it refers (outgoing links), as well as the records that points to it (incoming links or backlinks). Links and backlinks are contextualised: when hovering over them, a tooltip is displayed showing the paragraph in which the link is located in the corresponding record.

# Development

(translation in progress)

<!-- 
Cette partie de la documentation s'adresse à des développeurs expérimentés en JavaScript. Elle vous présente l'arborescence et les concepts sur lesquels reposent les *deux parties* formant Cosma, le cosmographe et le cosmoscope.

Nous vous recommandons vivement de lire le manuel d'utilisation pour bien saisir l'ensemble des usages en jeu dans le code source qui va vous être présenté ci-dessous.

## Architecture de Cosma

Cosma est principalement implémenté en JavaScript. Le logiciel repose sur deux systèmes distincts, le cosmographe et le cosmoscope.

Le **cosmographe** repose sur l'environnement Node.js. Une série de scripts permettent de :

- vérifier et actualiser le fichier de configuration ;
- générer des fichiers Markdown et leur entête ;
- scanner un répertoire pour en extraire les fichiers Markdown et analyser leur contenu (Markdown, métadonnées YAML et liens *wiki*) afin de générer :
	- des fichiers JSON ;
	- le cosmoscope (ses données et variables CSS).

Le **cosmoscope** est un fichier HTML exécuté sur navigateurs web, créé à partir d'un *template* [Nunjucks](https://mozilla.github.io/nunjucks/) (`template.njk`). Il intègre :

- les métadonnées web et styles issus de la configuration ;
- les scripts et bibliothèques JavaScript ;
- des index (mots-clés, titre de fiche, vues) ;
- les fiches.

::: important
Les liens ci-dessous présentent la liste exhaustive des fonctions de ces deux systèmes au sein du code source de Cosma :

- [Consulter l'API du cosmographe](./api/cosmographe/index.html)
- [Consulter l'API du cosmoscope](./api/cosmoscope/index.html)
:::

## Arborescence

Vous trouverez ci-dessous une description complète de l'arborescence du logiciel. Vous pourrez ainsi distinguer les fichiers concernant le cosmographe et ceux du cosmoscope.

```
.
├── docs/                   | répertoire de la documentation
│   ├── api/                | répertoire des index des API
│   │   └── [x].md          | introduction à l'index [x] de l'API
│   └── api-config-[x].json | config. de l'index [x] de l'API
├── functions/              | fonctions du COSMOGRAPHE
│   ├── autorecord.js       | création de fichiers Markdown formatés
│   ├── history.js          | création répertoires de l'historique des exports
│   ├── links.js            | analyse des liens wiki et de leurs attributs
│   ├── log.js              | affichage des alertes et création des registres
│   ├── modelize.js         | analyse des fichiers Markdown et création modèle de données
│   ├── record.js           | formulaire du terminal pour création des fichiers Md
│   ├── template.js         | intégration données, style et corps du COSMOSCOPE
│   └── verifconfig.js      | validation et modification de la configuration
├── template/               | 
│   ├── libs/               | bibliothèques JavaScript
│   ├── scripts/            | fonctions du COSMOSCOPE
│   │   ├── counter.js      | actuliser les compteurs d'entités
│   │   ├── filter.js       | appliquer filtres
│   │   ├── focus.js        | appliquer focus
│   │   ├── graph.js        | génération du graphe selon données et configuration
│   │   ├── index.js        | contrôle des volets et boutons du menu gauche
│   │   ├── keyboard.js     | affectation des raccourcis clavier
│   │   ├── main.js         | historique de navigation et les variables globales
│   │   ├── nodes.js        | affichage des nœuds
│   │   ├── record.js       | ouvrir/fermer le volet latéral droit
│   │   ├── search.js       | paramétrage moteur de recherche
│   │   ├── tag.js          | appliquer tags
│   │   ├── view.js         | enregistrer et appliquer une vue
│   │   └── zoom.js         | paramétrer les déplacement (latéral, zoom) au sein du graphe
│   ├── cosmalogo.svg       | logo du logiciel
│   ├── template.njk        | structure du COSMOSCOPE
│   ├── print.css           | styles d'impression du COSMOSCOPE
│   └── styles.css          | styles du COSMOSCOPE
├── app.js                  | adressage des commandes du terminal
└── package.json            | liste des dépendances NodeJs
```

## Fonctionnement du cosmographe

Il a trois utilisations possibles via le terminal. Ces différentes requêtes sont réceptionnées par `app.js` qui les renvoie :

- extraire et modéliser (`modelize.js`) puis intégrer (`template.js`) les données dans un cosmoscope ;
- générer des fichiers Markdown formatés (`record.js` et `autorecord.js`) ;
- modifier la configuration (`verifconfig.js`).

La configuration (le contenu du fichier `config.yml` devenu un objet JavaScript) est exportée de manière globale (depuis `verifconfig.js`). Elle peut être appelée comme ci-dessous.

```javascript
const config = require('./verifconfig').config;

const folderToExport = config.export_target;
```

## Scanne des fichiers

Depuis le fichier `modelize.js`, on extrait de chaque fichier Markdown les métadonnées (l'entête YAML) et le contenu (suivant l'entête YAML) (fichier `modelize.js`).

1. fonction [`catchLinksFromContent()`](./api/cosmographe/global.html#catchLinksFromContent) : Le contenu est scanné une première fois par une série d'expressions régulières pour en extraire les paragraphes, et pour chaque paragraphe les *wikilinks* contenus. Le paragraphe devient le contexte de ses liens et est transpilé en HTML.
2. fonction [`convertLinks()`](./api/cosmographe/global.html#convertLinks) : Le contenu du fichier est ensuite transformé pour y transformer les *wikilinks* en liens Markdown
3. fonction [`cosmoscope()`](./api/cosmographe/global.html#cosmoscope) : Le contenu du fichier est intégralement transpilé du Markdown à l'HTML.

Les fonctions 1 et 3 font appelle à la bibliothèque Markdown-it. Elle peut y être remplacée.

## Génération du cosmoscope

Le cosmoscope est généré grâce à la fonction [`cosmoscope()`](./api/cosmographe/global.html#cosmoscope). Elle intancie le modèle Nunjucks `template.njk` et y injecte les données relatives à la configuration, aux fiches et aux entités du graphe ainsi que leurs styles (sérialisés par la fonction [`colors()`](./api/cosmographe/global.html#colors)).

Nunjucks importe par ailleurs dans son `<head>` les fichiers de style CSS et les bibliothèques JavaScript ainsi que les fonctions JavaScript dans des balises `<script>` en fin de document. Les données relatives aux fiches et à la configuration sont intégrées via des boucles et autres structures de contrôle de Nunjucks.

Le tout est enregistré dans un fichier `cosmoscope.html` (plus un fichier sauvegardé dans l'[historique](#export)).

## Affichage du graphe

La génération et l'animation du graphe reposent sur la bibliothèque [D3](https://d3js.org/). Elle perçoit ses données depuis l'objet global `graph`. Cet object est composé de deux tableaux.

Le tableau **`graph.nodes`** contient toutes les données relatives aux nœuds, y compris une série de booléens permettant de connaître leur état d'affichage (voir la sérialisation par la fonction [`registerNodes()`](./api/cosmographe/global.html#registerNodes)). Cet état indiqué est actualisé à chaque modification d'affichage.

La tableau **`graph.links`** contient toutes les données relatives aux liens (voir la sérialisation par la fonction [`registerLinks()`](./api/cosmographe/global.html#registerLinks)).

Ces tableaux peuvent être injectés dans d'autres bibliothèques JavaScript de génération de graphe.

**[VisJs Network](https://github.com/visjs/vis-network)**

Fichier `/functions/modelize.js`

```javascript
function registerLinks(file) {
// ...
  for (const link of file.links) {
  // ...
    entities.links.push({
      // ...
      from: Number(link.source.id),
      to: Number(link.target.id),
      // ...
    });
  }
}
```

Fichier `/template/sripts/graph.js`

```javascript
const network = new vis.Network(
  document.getElementById('network')
  , data = {
    nodes: new vis.DataSet(graph.nodes),
    edges: new vis.DataSet(graph.links)
  }
  , {  } // options
);
```

**[SigmaJs](https://github.com/jacomyal/sigma.js/)**

```javascript
const network = new sigma({
  graph: {
    nodes: graph.nodes,
    edges: graph.links
  },
  container: 'network'
});
```

## Paramètres du graphe

Les paramètres du graphe sont extraits de la partie `graph_config` du fichier de configuration `config.yml`. Elle est injecté dans le modèle Nunjucks `template.njk` via la fonction [`cosmoscope()`](./api/cosmographe/global.html#cosmoscope). Dans le modèle elle est à la fois utilisée comme valeur par défaut des formulaires du menu « Paramètres du graphe » et implémentée comme objet global JavaScript `graphProperties`.

Ce même object global est actualisé par les différents formulaires du menu « Paramètres du graphe ». Il font ensuite appel à la fonction [`updateForces()`](./api/cosmographe/global.html#updateForces) pour relancer l'évaluation de ces paramètres par la biliothèque de visualisation D3.

## Raccourcis clavier

L'ensemble des raccourcis clavier du cosmoscope sont implémentés dans le fichier `/template/scripts/keyboard.js`. L'objet global `pressedKeys` contient la liste des touches surveillées pour modifier un comportement. D'autres touches (des lettres) sont listées pour appeler certaines fonctions et ne sont pas ajoutées à l'objet global `pressedKeys`.

Le booléen global `keyboardShortcutsAreWorking` défini si les raccourcis peuvent être utilisés ou non. Lors de la saisie dans un champ, il ne faut pas que les lettres servent à autre chose qu'écrire.

# Crédits

## Équipe

- [Arthur Perret](https://www.arthurperret.fr/) (porteur du projet)
- [Guillaume Brioudes](https://myllaume.fr/) (développeur)
- [Clément Borel](https://mica.u-bordeaux-montaigne.fr/borel-clement/) (chercheur)
- [Olivier Le Deuff](http://www.guidedesegares.info/) (chercheur)

## Bibliothèques utilisées

Pour améliorer la maintenabilité et la lisibilité du code source, l’équipe de développement a recouru aux bibliothèques suivantes.

- [D3.js](https://d3js.org/) v4.13.0 (BSD 3-Clause) : Génération du graphe
- [Nunjucks](https://mozilla.github.io/nunjucks/) v3.2.3 (BSD 2-Clause) : Génération du template du Cosmoscope
- [Js-yaml](https://github.com/nodeca/js-yaml) v3.14.0 (MIT License) : Lecture du fichier de configuration et écriture des YAML Front Matter
- [Js-yaml-front-matter](https://github.com/dworthen/js-yaml-front-matter) v4.1.0 (MIT License) : Lecture des YAML Front Matter des fichiers Markdown
- [Markdown-it](https://github.com/markdown-it/markdown-it) v12.0.2 (MIT License) : Conversion Markdown → HTML
- [Markdown-it-attrs](https://www.npmjs.com/package/markdown-it-attrs) v4.0.0  (MIT License) : Traitement des hyperliens Markdown au sein des fiches
- [Minify-html](https://github.com/wilsonzlin/minify-html) v0.4.3 (MIT License) : Allègement du Cosmoscope
- [Fuse.js](https://fusejs.io/) v6.4.6 (Apache License 2.0) : Moteur de recherche
- [Moment](https://momentjs.com/) v2.29.1 (MIT License) : Gestion de l'horodatage

## Historique du projet

Août 2020
: Prototypage d'un « Lexicographe » avec l'interface de l'[Otletosphère](https://github.com/hyperotlet/otletosphere).

Décembre 2020
: Début du développement de Cosma avec un nouveau cahier des charges.

Avril 2021
: Finalisation de la première version de Cosma.

 -->
